# Feature : Tracker de Heath(Model / Table)

### ğŸ’¡ SpÃ©cification Tracker SantÃ©

### **Ã‰pique : Tracker de SantÃ©**

---

### **`User Stories`**

### **1. Visualisation des DonnÃ©es de SantÃ©**

**En tant qu'utilisateur**

Je veux voir un tableau de bord de mes donnÃ©es de santÃ©

Afin de suivre mon Ã©tat de santÃ© global

**CritÃ¨res d'Acceptation** :

- [ ] Affichage d'un graphique des calories, poids et temps par jour
- [ ] Affichage d'un tableau des entrÃ©es de santÃ© (calories, poids, temps)
- [ ] Filtrage par semaine et mois
- [ ] Mise en Ã©vidence des tendances (progression, stagnation, rÃ©gression)

**`Definition of Done`** :

- Interface responsive
- Tests utilisateurs validÃ©s
- Performance < 2s pour le chargement

---

### **2. Gestion des EntrÃ©es de SantÃ©**

**En tant qu'utilisateur**

Je veux gÃ©rer mes entrÃ©es de donnÃ©es de santÃ©

Afin de maintenir un suivi prÃ©cis de mes progrÃ¨s

**CritÃ¨res d'Acceptation** :

- [ ] CrÃ©ation d'une nouvelle entrÃ©e (calories, poids, temps)
- [ ] Modification d'une entrÃ©e existante
- [ ] Suppression d'une entrÃ©e
- [ ] CatÃ©gorisation (par activitÃ© ou objectif, par exemple sport, alimentation)

**`Definition of Done`** :

- Validation des donnÃ©es
- Mise Ã  jour en temps rÃ©el du tableau de bord
- Confirmation des actions critiques

---

### **3. Analyse Graphique**

**En tant qu'utilisateur**

Je veux visualiser mes donnÃ©es sous forme de graphique

Afin dâ€™analyser mes tendances de santÃ©

**CritÃ¨res d'Acceptation** :

- [ ] Graphique linÃ©aire journalier ou hebdomadaire
- [ ] AgrÃ©gation automatique par jour/semaine
- [ ] LÃ©gende interactive
- [ ] Tooltips informatifs

---

### **4. Navigation et Pagination**

**En tant qu'utilisateur**

Je veux naviguer facilement dans mes donnÃ©es

Afin de retrouver rapidement les informations recherchÃ©es

**CritÃ¨res d'Acceptation** :

- [ ] Pagination par 10 Ã©lÃ©ments
- [ ] SÃ©lecteur de semaines et mois
- [ ] Tri par date ou catÃ©gorie
- [ ] Indicateur de chargement

---

### **Product Backlog Items (PBI)**

### **1. SÃ©curitÃ© et AccÃ¨s**

**PrioritÃ©** : Haute

**Estimation** : 8 points

- Authentification utilisateur
- Autorisation CRUD
- Protection des donnÃ©es personnelles

---

### **2. Interface Graphique**

**PrioritÃ©** : Haute

**Estimation** : 13 points

- Composant graphique
- Tableau de donnÃ©es
- Formulaires CRUD
- Design responsive

---

### **3. Gestion des DonnÃ©es**

**PrioritÃ©** : Haute

**Estimation** : 8 points

- ModÃ¨le de donnÃ©es pour calories, poids, temps
- AgrÃ©gation journaliÃ¨re et hebdomadaire
- Pagination
- Filtres

---

### **4. Performance**

**PrioritÃ©** : Moyenne

**Estimation** : 5 points

- Optimisation des requÃªtes
- Mise en cache
- Chargement progressif

---

### **Risques et DÃ©pendances**

### **Risques**

- Performance avec grand volume de donnÃ©es
- ComplexitÃ© des calculs d'agrÃ©gation
- ExpÃ©rience utilisateur sur mobile

### **DÃ©pendances**

- SystÃ¨me d'authentification
- Base de donnÃ©es performante
- BibliothÃ¨que de graphiques

---

### **MÃ©triques de SuccÃ¨s**

- Temps de chargement < 2s
- Satisfaction utilisateur > 4/5
- Taux d'erreur < 1%
- Adoption > 80% des utilisateurs cibles

---

### **Planning Agile**

### **Sprint 1 (1 semaine)**

- ModÃ©lisation des donnÃ©es
- CRUD des entrÃ©es de santÃ©
- Interface basique (Table)

### **Sprint 2 (1 semaine)**

- Graphiques
- AgrÃ©gations

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Nous allons faire la mÃªme chose que prÃ©cÃ©demment pour `Finance` mais avec `Heath`

- ModÃ©lisation de `Heath`

```tsx
export const healthCategoryEnum = pgEnum('health_category', [
  'calories',
  'poids',
  'temps',
])

export const health = pgTable('health', {
  id: uuid('id')
    .default(sql`uuid_generate_v4()`)
    .primaryKey(),
  value: integer('value').notNull(),
  date: timestamp('date', {withTimezone: true}).notNull(),
  category: healthCategoryEnum('category').notNull(),
  userId: uuid('userId')
    .notNull()
    .references(() => users.id, {onDelete: 'cascade'}),
})
```

- Repository `Heath`
  - CRUD de base
- Service `Heath`
  - CRUD de base + Autorisation de base

Comme câ€™est 80% identique pour la partie tableau, les exercices se concentrent sur les diffÃ©rences, le reste sera fourni.

## Exercice

Une diffÃ©rence majeure par rapport Ã  la feature `Finance`, est que nous avons en plus des annÃ©es, une agrÃ©gation par semaine. Nous voulons pouvoir tracker ce quâ€™un utilisateur a fait sur une semaine du lundi au dimanche de la semaine X. Exemple :

- Lundi : Poids : 80 Kilos | Sport : 2 heures | Calories : 2000k
- Mardi : Poids : 81 Kilos | Sport : 1 heures | Calories : 2200k
- etc â€¦

Les 2 grandes fonctions majeures Ã  adapter / crÃ©er sont :

- `getHealthsWithPaginationByWeekDao` : Les `heaths` par annÃ©e et semaine pour un `user`
- `getWeeksHealthsByYearDao` : Les `weeks` par `annÃ©e` oÃ¹ des donnÃ©es sont disponibles. Les semaines disponibles pourront Ãªtre insÃ©rÃ©es dans un second `<Select>` pour avoir par exemple les donnÃ©es du
  - 2025 : Semaine du â€˜28-07 au 03-08â€™

**ğŸ¶ ImplÃ©mente ces 2 fonctions de `repository Health`**

ğŸ’¡ Astuce pour `getHealthsWithPaginationByWeekDao` : `Postgrees` permet de filtrer par annÃ©e comme cela

```tsx
EXTRACT(YEAR FROM ${date}) = "2025"` //match avec les date de 2025
```

Pour filtrer par semaine, il est possible de faire :

```tsx
EXTRACT(WEEK FROM ${date}) = 52 // match avec les 52Ã¨me semaine de l'annÃ©e
```

Nous verrons plus tard comment convertir `â€˜28-07 au 03-08â€™` en numÃ©ro de `week`

Doc : [https://neon.tech/postgresql/postgresql-date-functions/postgresql-extract](https://neon.tech/postgresql/postgresql-date-functions/postgresql-extract)

ğŸ’¡ Astuce pour `getWeeksHealthsByYearDao` :

- Filtrer par `annÃ©e` pour un `user`
- ConcatÃ©ner avec [CONCAT](https://neon.tech/postgresql/postgresql-string-functions/postgresql-concat-function#summary)
- Obtenir le lundi avec [DATE_TRUNC(â€™weekâ€™)](https://neon.tech/postgresql/postgresql-date-functions/postgresql-date_trunc#summary)
- Obtenir le dimanche avec [`DATE(... + INTERVAL '6 day')`](https://neon.tech/postgresql/postgresql-tutorial/postgresql-interval)

```tsx
date_trunc('week', ${health.date}) //Donne le premier jour de la semaine de la date
TO_CHAR(..., 'DD-MM') // Formate la date en format "DD-MM"
DATE(... + INTERVAL '6 day') //Ajoute 6 jours Ã  la date de dÃ©but pour obtenir la fin de semaine (dimanche)
```

Pour Ã©viter les doublons :

```tsx
.selectDistinct({
      week: sql<string>`<SQL REQUETE>`.as(
        'week'
      ),
    })
```

Fichiers

- `data/repositories/health-repository.ts`

## Bonus

### 1. ğŸš€ Filtrer par semaine : `Select`

Pour filtrer par semaine, la premiÃ¨re chose Ã  faire est dâ€™ajouter un `queryParam` : `healthWeek` Ã  la route `/heath`, par exemple :

- `/health?healthWeek=28-07+au+03-08`

Dans un second temps, il va falloir convertir cette chaine â€˜`28-07+au+03-08`â€™ en numÃ©ro de semaine dans lâ€™annÃ©e. Pour cela, tu as Ã  ta disposition `getWeekFromLabel`

```tsx
export const getWeekFromLabel = (label: string, year: string) => {
  // Extrait les 5 premiers caractÃ¨res du label (format "DD-MM" depuis "DD-MM+au+DD-MM")
  const week = label.slice(0, 5)
  // DÃ©compose la chaÃ®ne "DD-MM" en jour et mois
  const [day, month] = week.split('-')
  // CrÃ©e un objet Date Ã  partir du jour, mois et annÃ©e
  // Format attendu par parse: "YYYY-MM-DD"
  const parsedDate = parse(
    `${year}-${month}-${Number(day)}`,  // Construit la chaÃ®ne de date complÃ¨te
    'yyyy-MM-dd',                        // SpÃ©cifie le format de la date
    new Date()                           // Date de rÃ©fÃ©rence (fallback)
  )
  // Calcule le numÃ©ro de la semaine (1-53) pour la date donnÃ©e
  const startWeek = getWeek(parsedDate)
  return startWeek
}
```

- ğŸ¶ Dans un premier temps, adapte la route (`app/(app)/health/page`) pour avoir les bons params et faire les bons appels aux services
- ğŸ¶ Dans un second temps, occupe-toi du `Select Year Week` (`health-year-select.tsx`)
  - Ajoute un deuxiÃ¨me select pour les `weeks`
  - Change les `queryParams` lors dâ€™un changement dâ€™item dans le select
  ```tsx
  //exemple
  const params = new URLSearchParams(searchParams)
  params.set("param", "value")
  router.push(`${pathname}?${params.toString()}`, {scroll: false})
  ```

Fichiers

- `app/(app)/health/page`
- `acomponent/dashboard/tracker/heath/health-year-select.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://neon.tech/postgresql/postgresql-tutorial/](https://neon.tech/postgresql/postgresql-tutorial)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=9.SAAS%20Entrepreneur&entry.533578441=06%20feature-health-crud).
