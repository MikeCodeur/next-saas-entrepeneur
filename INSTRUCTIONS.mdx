# Formulaire / Modal

### 💡 Faire un formulaire dans une modal (Dialog)

## 📝 Tes notes

Detaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Il existe un composant `Shadcn` permettant de gérer les `Dialog` avec (`radix`)

📑 Le liens vers la doc : [https://ui.shadcn.com/docs/components/dialog](https://ui.shadcn.com/docs/components/dialog)

Exemple :

```tsx
import { Button } from "@/components/ui/button"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"

export function DialogDemo() {
  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button variant="outline">Edit Profile</Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>Edit profile</DialogTitle>
          <DialogDescription>
            Make changes to your profile here. Click save when you're done.
          </DialogDescription>
        </DialogHeader>
        <div className="grid gap-4 py-4">
          <div className="grid grid-cols-4 items-center gap-4">
            <Label htmlFor="name" className="text-right">
              Name
            </Label>
            <Input id="name" value="Pedro Duarte" className="col-span-3" />
          </div>
        </div>
        <DialogFooter>
          <Button type="submit">Save changes</Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}

```

Une première pourrait idée pourrait être de faire autant de `Dialog` que nécessaire (`Finance`, `Health`, `Login` etc …)

Mais cela fait beaucoup de duplication de code :

- `<Dialog>`
- `<DialogTrigger asChild>`
- `<DialogContent>` etc …

Nous voulons ici une gestion unique des `Dialog` au sein de notre application. Nous allons pour ça utiliser le `State Management Pattern` et l’`API Context.` L'idée est de gérer les états (`states`) des dialogue dans un contexte commun.

Il faut voir cela comme des states partagés dans notre application (et non pas uniquement dans un composant donné)

Un des cas les plus classique pour représenter ce pattern est la gestion du thème dans une application

### 1. **Créer un contexte**

Crée un fichier pour ton contexte, par exemple `ThemeContext.tsx` :

```tsx
import { createContext, ReactNode, useContext, useState } from 'react';

// Créer le contexte
export const ThemeContext = createContext<{
  theme: string;
  toggleTheme: () => void;
} | null>(null);

// Fournir le contexte
export const ThemeProvider = ({ children }: { children: ReactNode }) => {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme((prev) => (prev === 'light' ? 'dark' : 'light'));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

// Hook personnalisé pour simplifier l'utilisation du contexte
export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};
```

Note : Depuis React 19 il est possible d’utiliser `use` à la place de `useContext`

- [https://react.dev/reference/react/use](https://react.dev/reference/react/use)

### 2. **Utiliser le contexte dans l'application**

Intègre le `ThemeProvider` dans l'arborescence de ton application.

### `App.tsx`

```tsx

import { ThemeProvider } from './ThemeContext';
import ThemeSwitcher from './ThemeSwitcher';

function App() {
  return (
    <ThemeProvider>
      <div>
        <h1>Exemple de Contexte</h1>
        <ThemeSwitcher />
      </div>
    </ThemeProvider>
  );
}

export default App;

```

Un composant qui nomme le contexte pour afficher et modifier le thème.

### `ThemeSwitcher.tsx`

```tsx

import { useTheme } from './ThemeContext';

const ThemeSwitcher = () => {
  const { theme, toggleTheme } = useTheme();

  return (
    <div>
      <p>Thème actuel : {theme}</p>
      <button onClick={toggleTheme}>
        Basculer en {theme === 'light' ? 'sombre' : 'clair'}
      </button>
    </div>
  );
};

export default ThemeSwitcher;

```

## Exercice

Dans cet exercice tu vas devoir implémenter la gestion des modal (`shadcn`) avec le context API.

- [https://react.dev/reference/react/createContext](https://react.dev/reference/react/createContext)
- [https://react.dev/reference/react/use](https://react.dev/reference/react/use)

**🐶** Dans un premier temps créer le `ModalProvider` / `ModalContext` et le hook `useModal` dans `componant/modal.ts`

**🐶 Ensuite utilise** `ModalProvider` dans le `RootLayout` pour pouvoir utiliser `useModal` partout dans l’application

Fichiers

- `componant/modal.ts`
- `app/layout.ts`

## Bonus

### 1. 🚀 Modal à partir d’un bouton (Ajout)

Dans cet exercice tu vas devoir créer un bouton qui ouvre la modal qui contient le formulaire d’ajout

Pour gagner du temps les formulaires sont déjà créés avec [`shadcn /zod / rhf`](https://ui.shadcn.com/docs/components/form)

- `component/dashboard/trackers/finance/forms/create-edit-finance-form.tsx`
- `component/dashboard/trackers/finance/forms/delete-finance-form.tsx`
- `component/dashboard/trackers/health/forms/create-edit-health-form.tsx`
- `component/dashboard/trackers/health/forms/delete-health-form.tsx`

Et le composant `AddItemButton` est déjà ajouté dans les `Tables`; nous allons pouvoir travailler directement dans ce composant

- `component/dashboard/trackers/add-item-button.tsx`

```tsx
const FinanceDataTable = ({finances, uid}: FinanceDataTableProps) => {
  const label = 'Tracker une dépense / revenu'
  return (
    <Card className="flex w-full flex-col space-y-2 py-4 md:items-start md:px-8">
	     {/* AddItemButton  */}
      <AddItemButton trackerType="finance" uid={uid} label={label} />
      <DataTable columns={financeColumns} dataTable={finances} />
    </Card>
  )
}
```

- **🐶 Dans cet exercice utilise le `hook useModal` créé précédemment de la manière suivante :**

```tsx
const {onClose, setModal, onOpen} = useModal()
//
return (
  <Button
    onClick={() => {
      setModal({
        title: `Ajout`,
        children: <FormAdd onClose={onClose} uid={uid} />,
      })
      onOpen()
    }}
  >
  </Button>
  )

```

💡 Attention : nous allons faire en sorte que le composant puisse prendre différents type de Formulaires pour le rendre plus générique, des :

- `CreateEditFinanceForm` ou
- `CreateEditHealthForm`

💡 Vérifie l’appel des servers actions `health-action` / `finance-action`

Fichiers

- `component/dashboard/trackers/add-item-button.tsx`

### 2. 🚀 Modal dans une table (Update / Delete Item)

Nous avions rajouter une colonnes action avec `update` / `delete` mais sans effet. Nous allons maintenant ouvrir les modal correspondant a `update` et `delete` avec le `Formulaire` correspondant. Tout ce passe dans `data-table-row-actions`

```tsx
  <DropdownMenu>
      <DropdownMenuTrigger asChild className="p-2">
        <Button variant="ghost" className="h-8 w-8 p-0">
          <span className="sr-only">Ouvrir menu</span>
          <MoreHorizontal className="h-4 w-4" />
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        <DropdownMenuItem>Editer</DropdownMenuItem>
        <DropdownMenuItem>Supprimer</DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
```

💡 Attention : nous allons faire en sorte que le composant puisse prendre différents type de Formulaires pour le rendre plus générique.

💡 Vérifie l’appel des servers actions `health-action` / `finance-action`

Fichiers

- `component/ui/data-table-row-actions.tsx`

## Aller plus loin

📑 Le lien vers la doc [https://ui.shadcn.com/docs/components/form](https://ui.shadcn.com/docs/components/form)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.SAAS%20Entrepreneur&entry.533578441=07-modal-form-edition).
