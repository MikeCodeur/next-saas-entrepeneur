# Chart Finance (ReChart)

### ğŸ’¡ Faire des graphiques

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Pour faire des graphiques, il existe une excellente librairie `React` : [ReChart](https://recharts.org/en-US/)

De plus, [shadcn](https://ui.shadcn.com/docs/components/chart) a introduit un composant chart basÃ© sur `reChart`, nous lâ€™avons ajoutÃ© au projet.

```tsx
pnpm dlx shadcn@latest add chart
```

Nous allons ici utiliser 2 types de graphiques

- Sous forme de ligne `LineChart`
- Sous forme de barre `BarChart`

ğŸ“‘ Le lien vers la doc [https://ui.shadcn.com/docs/components/chart](https://ui.shadcn.com/docs/components/chart)

Pour gagner du temps, nous avons mis en place dans `global.css`

```css
--chart-1: 12 76% 61%;
--chart-2: 173 58% 39%;
--chart-3: 197 37% 24%;
--chart-4: 43 74% 66%;
--chart-5: 27 87% 67%;
```

que nous pouvons utiliser pour la configuration comme par exemple :

### LineChart

Exemple de configuration :

```tsx
const chartConfig = {
  visitors: {
    label: "Total Visitors",
  },
  chrome: {
    label: "Chrome",
    color: "hsl(var(--chart-1))",
  },
  safari: {
    label: "Safari",
    color: "hsl(var(--chart-2))",
  },
} satisfies ChartConfig
```

Exemple de graphique :

```tsx
   <ChartContainer
      config={chartConfig}
      className="max-h-96 min-h-[200px] w-full"
    >
      <LineChart
        accessibilityLayer
        data={[
          {
            browser: 'Chrome',
            visitors: 275,
          },
          {browser: 'Firefox', visitors: 564},
          {browser: 'Arc', visitors: 345},
          {browser: 'Safari', visitors: 699},
          {browser: 'Opera', visitors: 34},
        ]}
      >
        <XAxis
          dataKey="browser"
          tickLine={false}
          axisLine={false}
          tickMargin={8}
          tickFormatter={(value) => value}
        />
        <ChartTooltip cursor={false} content={<ChartTooltipContent />} />
        <ChartLegend content={<ChartLegendContent />} />
        <Line
          dataKey="visitors"
          type="monotone"
          stroke="var(--color-revenus)"
          strokeWidth={2}
          dot={false}
        />
      </LineChart>
    </ChartContainer>
```

## Exercice

Dans cet exercice, tu vas devoir crÃ©er un `LineChart` pour les finances.

Le but est dâ€™avoir toutes les donnÃ©es sur une annÃ©e groupÃ©es par mois et type.

- Sur lâ€™axe X : Les mois de lâ€™annÃ©e oÃ¹ il y a des donnÃ©es.
- Sur lâ€™axe Y : La valeur en euros.
- Line 1 : La courbe des revenus.
- Line 2 : La courbe des dÃ©penses.
- Line 3 : La courbe des actifs.

- **ğŸ¶** Dans un premier temps, crÃ©e le Dao **`getFinancesChartByYearDao`**

RÃ©cupÃ¨re les totaux mensuels des dÃ©penses, des revenus et des actifs d'un utilisateur pour une annÃ©e donnÃ©e, triÃ©s chronologiquement.

En terme SQL :

- Filtre par annÃ©e et user :
  ```tsx
   .where(
        sql`${finance.userId} = ${uid} AND EXTRACT(YEAR FROM ${finance.date}) = ${year}`
      )
  ```
- Groupe par mois et annÃ©e
  ```tsx
   .groupBy(
        sql`EXTRACT(YEAR FROM ${finance.date})`,
        sql`EXTRACT(MONTH FROM ${finance.date})`
      )
  ```
- Trie
  ```tsx
  .orderBy(
      desc(sql`EXTRACT(YEAR FROM ${finance.date})`),
      sql`EXTRACT(MONTH FROM ${finance.date})`
    )
  ```
- Somme de chaque `catÃ©gorie`

```tsx
sql<number>`SUM(CASE WHEN ${finance.category} = 'dÃ©penses' THEN ${finance.amount} END)`.as(
          'dÃ©penses'
        ),
```

- **ğŸ¶** ImplÃ©mente cette fonction dans \*\*\*\*`finance-repository.ts` dans le but dâ€™avoir cette forme lÃ 

```tsx
[
  { month: 'Jan', 'dÃ©penses': 1234, revenus: 3434, actifs: 3000 },
  { month: 'Feb', 'dÃ©penses': 0, revenus: 345, actifs: 0 },
  { month: 'Apr', 'dÃ©penses': 699, revenus: 0, actifs: 0 },
  { month: 'Sep', 'dÃ©penses': 0, revenus: 1136, actifs: 0 }
]
```

Note : Le service appelle dÃ©jÃ  le repository, il nâ€™y a rien Ã  faire, tu peux appeler le service `getFinancesChartByYear` depuis la route.

- **ğŸ¶**Adapte la route `app/(app)/finance/page.ts` pour appeler `getFinancesChartByYear` et passer les donnÃ©es Ã  notre `LineChart`

```tsx
const financesForChart = await getFinancesChartByYear(financeYear, userId)
<FinanceLineChart data={financeFormatted} />
```

Note : Utilise `formatedFinanceData`, une fonction qui formate les valeurs `null` et `undefined` pour le graphique.

Fichiers

- `data/repositories/finance-repository.ts`
- `app/(app)/finance/page.ts`

## Bonus

### 1. ğŸš€ Chart Finance

**ğŸ¶** Dans cet exercice, tu vas devoir crÃ©er le graphique en ligne `FinanceLineChart`

- Step 1 : `chartConfig` avec les couleurs des lignes.
- Step 2 : CrÃ©er un `ChartContainer` `LineChart`.
- Step 3 : CrÃ©er un `XAxis` pour configurer lâ€™axe des abscisses.
- Step 4 : CrÃ©er les 3 lignes avec le composant `Line`.

Fichiers

- `component/dashboard/finance/finance-line-chart.tsx`

### 2. ğŸš€ Mettre les mois vides Ã  zÃ©ro

Il se peut que lâ€™utilisateur nâ€™entre pas de donnÃ©es sur certains mois. Dans ce cas, il est possible dâ€™adapter `formatedFinanceData` pour mettre les mois Ã  zÃ©ro

Fichiers

- `chart-utils.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc de [ReChart](https://recharts.org/en-US/)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=9.SAAS%20Entrepreneur&entry.533578441=08%20chart-finance-line).
