# Feature : Tracker de finance (Model / Table)

### ğŸ’¡ Voila une spÃ©cification fonctionnelle

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

**ğŸ‘¨â€âœˆï¸** Hugo Le chef de projet de donne une spÃ©cification fonctionnelle (formalisme agil scrum)

### **Ã‰pique : Gestion des Finances Personnelles**

---

### **User Stories**

### **1. Visualisation des DonnÃ©es FinanciÃ¨res**

**En tant qu'utilisateur**

Je veux voir un tableau de bord de mes finances

Afin de suivre ma situation financiÃ¨re globale

**CritÃ¨res d'Acceptation** :

- [ ] Affichage d'un graphique mensuel
- [ ] Affichage d'un tableau des transactions
- [ ] Filtrage par annÃ©e
- [ ] Distinction entre revenus, dÃ©penses et actifs

**Definition of Done** :

- Interface responsive
- Tests utilisateurs validÃ©s
- Performance < 2s pour le chargement

---

### **2. Gestion des Transactions**

**En tant qu'utilisateur**

Je veux gÃ©rer mes transactions financiÃ¨res

Afin de maintenir un suivi prÃ©cis de mes mouvements d'argent

**CritÃ¨res d'Acceptation** :

- [ ] CrÃ©ation d'une nouvelle transaction
- [ ] Modification d'une transaction existante
- [ ] Suppression d'une transaction
- [ ] CatÃ©gorisation (revenus/dÃ©penses/actifs)

**Definition of Done** :

- Validation des donnÃ©es
- Mise Ã  jour en temps rÃ©el du graphique
- Confirmation des actions critiques

---

### **3. Analyse Graphique**

**En tant qu'utilisateur**

Je veux visualiser mes donnÃ©es sous forme de graphique

Afin d'analyser les tendances de mes finances

**CritÃ¨res d'Acceptation** :

- [ ] Graphique linÃ©aire mensuel
- [ ] AgrÃ©gation automatique par mois
- [ ] LÃ©gende interactive
- [ ] Tooltips informatifs

---

### **4. Navigation et Pagination**

**En tant qu'utilisateur**

Je veux naviguer facilement dans mes donnÃ©es

Afin de retrouver rapidement les informations recherchÃ©es

**CritÃ¨res d'Acceptation** :

- [ ] Pagination par 10 Ã©lÃ©ments
- [ ] SÃ©lecteur d'annÃ©es
- [ ] Tri par date
- [ ] Indicateur de chargement

---

### **Product Backlog Items (PBI)**

### **1. SÃ©curitÃ© et AccÃ¨s**

**PrioritÃ©** : Haute

**Estimation** : 8 points

- Authentification utilisateur
- Autorisation CRUD
- Protection des donnÃ©es personnelles

---

### **2. Interface Graphique**

**PrioritÃ©** : Haute

**Estimation** : 13 points

- Composant graphique
- Tableau de donnÃ©es
- Formulaires CRUD
- Design responsive

---

### **3. Gestion des DonnÃ©es**

**PrioritÃ©** : Haute

**Estimation** : 8 points

- ModÃ¨le de donnÃ©es
- AgrÃ©gation mensuelle
- Pagination
- Filtres

---

### **4. Performance**

**PrioritÃ©** : Moyenne

**Estimation** : 5 points

- Optimisation des requÃªtes
- Mise en cache
- Chargement progressif

---

### **Risques et DÃ©pendances**

### **Risques**

- Performance avec grand volume de donnÃ©es
- ComplexitÃ© des calculs d'agrÃ©gation
- ExpÃ©rience utilisateur sur mobile

### **DÃ©pendances**

- SystÃ¨me d'authentification
- Base de donnÃ©es performante
- BibliothÃ¨que de graphiques

---

### **MÃ©triques de SuccÃ¨s**

- Temps de chargement < 2s
- Satisfaction utilisateur > 4/5
- Taux d'erreur < 1%
- Adoption > 80% des utilisateurs cibles

---

### **Planning Agile**

### **Sprint 1 (1 semaine)**

- ModÃ©lisation
- CRUD transactions
- Interface basique (Table)

### **Sprint 2 (1 semaines)**

- Graphiques
- AgrÃ©gations

### Dans cette exercice tu vas commencer par afficher les donnÃ©es finance dans un tableau.

###

## Exercice

La premiÃ¨re partie va consister a modÃ©liser `Finance` avec `Drizzle` et crÃ©er un `repository` et un `service` .

Pour Rappel :

- `Model` : DÃ©finition des tables, colonnes, relations
- `Repository` : AccÃ¨s aux donnÃ©es
- `Service` : Validation de donnÃ©es, autorisation

ğŸ¶ Step 1 : Model Commence par implÃ©menter le model `Finance` dans `data/model/finance-model.ts`

- Pense Ã  crÃ©er une isolation de types dans `types/domain/finance-types.ts`

ğŸ¶ Step 2 : Repo : ImplÃ©mente un CRUD

- `createFinanceByUidDao` : CrÃ©ation dâ€™un finance pour un user spÃ©cifique
- `getFinanceByIdDao`: RÃ©cupÃ©ration dâ€™une finance par `id`
- `updateFinanceByidDao` : Mise Ã  jour dâ€™une finance par `id`
- `deleteFinanceByidDao`: Suppression dâ€™une finance par `id`
- `getFinancesByUidDao`: Toutes les finances dâ€™un `userId`
- `getYearsFinancesByUidDao`: Toutes annÃ©es finance dâ€™un `userId`
- `getFinancesWithPaginationByYearDao`: Toutes les finances dâ€™un `userId` sur une filtrer par annÃ©es avec une pagination trier par date

ğŸ¶ Step 3 : Service : Appelle toutes les fonctions du repository en ajoutant :

- La validation des donnÃ©es `Zod` (Les schÃ©mas `Zod` sont fournis)

```tsx
import {
  createFinanceServiceSchema,
  updateFinanceServiceShema,
} from './validations/finance-validation'
```

- Ajoute lâ€™autorisation `canCreateFinance` etc â€¦ dans les fonctions du service. Dans un premier temps `lâ€™authorization` fait une simple vÃ©rification sur le rÃ´le admin (nous reviendrons dessus plus tard)

```tsx
export const canCreateFinance = async (resourceUid: string) => {
  const authUser = await getUserAuthExtented()
  const hasRoleAdmin = idAdmin(authUser?.user)
  if (hasRoleAdmin) return true
  return true
}
```

ğŸ¶ Step 4 : Route Finance : Appelle toutes les fonctions du service dans la route `/finance` (avec les bon paramÃ¨tre), dans un premier temps ne te soucie pas de lâ€™affiche en tableau nous le verrons dans lâ€™exercice suivant :

ImplÃ©mente la route `/finance` **avec les caractÃ©ristiques suivantes**

- RÃ©cupÃ¨re tous les `queryParams` nÃ©cessaires au requÃªtage de donnÃ©es
  - `financeYear`
  - `page`
  - `pageSize`
- Appelle le service `getFinancesWithPaginationByYear`
- Appelle le service `getYearsFinancesByUid`

<aside>
ğŸ’¡

Fait des tests avec URL :[http://localhost:3000/finance?page=1&financeYear=2024&pageSize=1](http://localhost:3000/finance?page=1&financeYear=2024&pageSize=1)

</aside>

Fichiers

- `data/model/finance-model.ts`
- `types/domain/finance-types.ts`
- `data/repositories/finance-repository.ts`
- `services/finance-repository.ts`
- `services/authorization/finance-authorization.ts`
- `app/(app)/finance/page.tsx`

## Bonus

### 1. ğŸš€ Shacn Data Table

Tu vas devoir afficher un tableau pour les `Finance`, `Shadcn` propose un composant basÃ© sur `Tantack Table` (anciennement React-Table)

- [https://ui.shadcn.com/docs/components/data-table](https://ui.shadcn.com/docs/components/data-table)

### Pour gagner du temps le composant `shadcn` est dÃ©jÃ  ajoutÃ©

```tsx
pnpm dlx shadcn@latest add table
pnpm add @tanstack/react-table
```

- Lâ€™Ã©tape de dÃ©finition des `colonnes` est faite (`finance-columns.tsx`)
- Lâ€™Ã©tape de dÃ©finition de `dataTable` est faite (`data-table.tsx`)
- Lâ€™Ã©tape de `row action` est faite (`data-table-row-actions.tsx`)
- Lâ€™Ã©tape de pagination est faite (`data-table-pagination.tsx`)

### Pour gagner du temps le composant `FinanceTable` (extension de React Table) est dÃ©jÃ  ajoutÃ©

- `component/dashboard/trackers/finance/finance-data-table.tsx` etc â€¦

```tsx
type FinanceDataTableProps = {
  uid: string
  financeTable: {
    data: FinanceDTO[]
    pagination: Pagination
  }
}

const FinanceDataTable = ({financeTable}: FinanceDataTableProps) => {
  return <DataTable columns={financeColumns} dataTable={financeTable} />
}

export default FinanceDataTable
```

**Exercice :**

Nous allons utiliser et adapter le `FinanceDataTable` .

```tsx
  <FinanceDataTable finances={finances} />

  //qui est un wrapper de DataTable avec la defition de colonnes
  const FinanceDataTable = ({finances}: FinanceDataTableProps) => {
  return <DataTable columns={financeColumns} dataTable={finances} />

```

- ğŸ¶ Dans un premier temps ajoute les colonnes nÃ©cessaires pour afficher les donnÃ©es de la Table dans `component/dashboard/trackers/finance/finance-columns.tsx`.

`Tanstack Table` permet de dÃ©finir des colonnes comme cela avec :

ğŸ“‘ Le lien vers la do [https://tanstack.com/table/v8/docs/guide/column-defs](https://tanstack.com/table/v8/docs/guide/column-defs)

```tsx
export const financeColumns: ColumnDef<Finance>[] = [
  {
    accessorKey: 'date',
    header: ({column}) => (
      <DataTableColumnHeader column={column} title="Date" />
    ),
    cell: ({row}) => {
      const date = new Date(row.getValue('date'))
      const formatted = formattedDate(date)
      return <div className="min-w-fit text-left md:w-[200px]">{formatted}</div>
    },
    filterFn: (row, date, value) => {
      return value.includes(row.getValue(date))
    },
  },
```

- ğŸ¶ CrÃ©er la `pagination` dans `data-table-pagination.tsx`. Le composant est repris de `chadcn` mais il faut choisir le comportement dâ€™implÃ©mentation. Nous allons ici utiliser le `router` et changer les `queryParams` de la route `finance`. nous lâ€™avons tester prÃ©cÃ©demment est nos `queryParam` sont censÃ©s retourner les bonnes donnÃ©es
- [http://localhost:3000/finance?page=1&financeYear=2024&pageSize=1](http://localhost:3000/finance?page=1&financeYear=2024&pageSize=1)

```tsx
const router = useRouter()
const searchParams = useSearchParams()
const pathname = usePathname()

//exemple changer les queryParam page 4
 const params = new URLSearchParams(searchParams)
 params.set('page', '4')
 router.push(`${pathname}?${params.toString()}`)
```

Fichiers

- `app/(app)/finance/page.tsx`
- `component/dashboard/trackers/finance/finance-columns.tsx`
- `component/ui/data-table-pagination.tsx`
- `component/dashboard/trackers/finance/finance-*.tsx`
- `component/ui/data-*.tsx`

### 2. ğŸš€ Changement dâ€™annÃ©es : Select

Pour gagner du temps le composant `finance-year-select` est dÃ©jÃ  prÃ©sent

```tsx
<Card>
      <CardHeader className="space-y-4 text-xl font-semibold">
        <CardTitle>Finance</CardTitle>
        <SelectTime
          currentTime={currentYear ?? years?.[0].year}
          times={years}
          handleChange={handleChangeYear}
          placeholder="SÃ©lectionnez une annÃ©e"
        />
      </CardHeader>
      <CardContent className="p-4">{children}</CardContent>
    </Card>
```

- **ğŸ¶ Utilise ce composant au niveau de la route `/finance` dans un premier temps**
- Ensuite Ã©dite le pour que `handleChangeYear` change lâ€™annÃ©e en `queryParams`

Fichiers

- `app/(app)/finance/page.tsx`
- `component/dashboard/trackers/finance/finance-year-select.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://tanstack.com/table/v8/docs/introduction](https://tanstack.com/table/v8/docs/introduction)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.SAAS%20Entrepreneur&entry.533578441=05%20Feature%20finance-crud-table).
