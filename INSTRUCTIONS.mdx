# Chart Health Bar

### ğŸ’¡ Faire un graphique de santÃ© en barre (par semaine)

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Le graphique de santÃ© est un graphique sous forme de barres.

- sur lâ€™axe X : Les jours de la semaine sÃ©lectionnÃ©e
- sur lâ€™axe Y :
  - 3 barres par jours (Poids / Calories / Temps de sport )

Pour faire des graphique en barre nous avons Ã  notre disposition avec [shadcn](https://ui.shadcn.com/docs/components/chart) un composant `<BarChart>` : Voila un exemple basique

```tsx
<ChartContainer
      config={chartConfig}
      className="max-h-96 min-h-[200px] w-full"
    >
      <BarChart
        accessibilityLayer
        data={[
          {month: 'Jan', desktop: 4354, mobile: 120},
          {month: 'Feb', desktop: 5688, mobile: 280},
          {month: 'Mar', desktop: 0, mobile: 120},
          {month: 'Jul', desktop: 2345, mobile: 394},
        ]}
      >
        <XAxis
          dataKey="month"
          tickLine={false}
          tickMargin={10}
          axisLine={false}
          tickFormatter={(value) => value.slice(0, 3)}
        />

        <ChartTooltip
          cursor={false}
          content={<ChartTooltipContent indicator="dashed" />}
        />
        <ChartLegend content={<ChartLegendContent />} />
        <Bar
          dataKey="desktop"
          radius={4}
        />
        <Bar
          dataKey="mobile"
          radius={4}
        />
      </BarChart>
    </ChartContainer>
```

ğŸ“‘ Le liens vers la doc [https://ui.shadcn.com/docs/components/chart](https://ui.shadcn.com/docs/components/chart)

## Exercice

Dans cet exercice nous allons devoir crÃ©er `une requÃªte imbriquÃ©e`

- Dans un premier temps crÃ©er la requÃªte permettant de de rÃ©cupÃ©rer les donnÃ©es de santÃ© pour :
- Un `user` a une `annÃ©e` et `semaine` precise

```tsx
.where(
      sql`${health.userId} = ${uid} AND EXTRACT(WEEK FROM ${health.date} AT TIME ZONE 'UTC') = ${week} AND EXTRACT(YEAR FROM ${health.date} AT TIME ZONE 'UTC') = ${year}`
    )
```

- GroupÃ© par jour de la semaine (monday â€¦ sunday)

```tsx
.groupBy(sql`EXTRACT(DAY FROM ${health.date} AT TIME ZONE 'UTC')`)
```

- Avec la sommes des Ã©lÃ©ments catÃ©gorie sur une jours : (ex : toutes les calories du jours X)

```tsx
 calories:
    sql<number>`SUM(CASE WHEN ${health.category} = 'calories' THEN ${health.value} ELSE NULL END)`.as(
      'calories'
    ),
```

- Creation dâ€™un alias

```tsx
.as('sq')
```

Nous pourrons ensuite faire une requÃªte sur lâ€™alias crÃ©Ã© percement

```tsx
const rows = await db
    .select({
      week: sq.week,
      calories: sq.calories,
      temps: sq.temps,
      poids: sq.poids,
    })
    .from(sq)
    .orderBy(sq.week)
```

- **ğŸ¶ Dans cet exercice implÃ©mente `getHealthsChartbyWeekDao` dans** `health-repository.ts`

Fais en sorte dâ€™avoir des donnÃ©e sous cette forme

```tsx
healths [
  {
    week: '2025-01-13 00:00:00+00',
    calories: '4354',
    temps: '120',
    poids: '90'
  },
  {
    week: '2025-01-14 00:00:00+00',
    calories: '5688',
    temps: '280',
    poids: '99'
  },
]
```

- **ğŸ¶ Dans un second temps appelle cette fonction dans la route**

```tsx
const healths = await getHealthsChartbyWeek
//helper pour formatter le jour
const healthsFormatted = formatedHealthData(healths, 'week')
//HealthBarChart
 <HealthBarChart data={healthsFormatted} />

```

Fichiers

- `data/repositories/health-repository.ts`
- `app/(app)/health/page.tsx`

## Bonus

### 1. ğŸš€ CrÃ©er le graphique en barre

Le graphique en barre sâ€™utilise avec un `<BarChart accessibilityLayer data={data}>` et des `<Bar>` exemple

```tsx
 <Bar
	  dataKey="calories"
	  fill="var(--color-calories)"
	  radius={4}
	  yAxisId={'calories'}
	/>
```

- **ğŸ¶ CrÃ©Ã© le graphique en barre**

Fichiers

- `/components/dashboard/trackers/health/health-bar-chart.tsx`

### 2. ğŸš€ Valeur par default

Fais en sorte d'avoir des valeur Ã  zÃ©ro pour les jour vide

Fichiers

- `formatedHealthData`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://ui.shadcn.com/docs/components/chart](https://ui.shadcn.com/docs/components/chart)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.SAAS%20Entrepreneur&entry.533578441=09%20chart-bar-heath).
