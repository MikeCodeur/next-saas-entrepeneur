# Formulaire / Modal

### ğŸ’¡ Faire un formulaire dans une modal (Dialog)

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Il existe un composant `Shadcn` permettant de gÃ©rer les `Dialog` avec (`radix`)

ğŸ“‘ Le liens vers la doc : [https://ui.shadcn.com/docs/components/dialog](https://ui.shadcn.com/docs/components/dialog)

Exemple :

```tsx
import { Button } from "@/components/ui/button"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"

export function DialogDemo() {
  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button variant="outline">Edit Profile</Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>Edit profile</DialogTitle>
          <DialogDescription>
            Make changes to your profile here. Click save when you're done.
          </DialogDescription>
        </DialogHeader>
        <div className="grid gap-4 py-4">
          <div className="grid grid-cols-4 items-center gap-4">
            <Label htmlFor="name" className="text-right">
              Name
            </Label>
            <Input id="name" value="Pedro Duarte" className="col-span-3" />
          </div>
        </div>
        <DialogFooter>
          <Button type="submit">Save changes</Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}

```

Une premiÃ¨re pourrait idÃ©e pourrait Ãªtre de faire autant de `Dialog` que nÃ©cessaire (`Finance`, `Health`, `Login` etc â€¦)

Mais cela fait beaucoup de duplication de code :

- `<Dialog>`
- `<DialogTrigger asChild>`
- `<DialogContent>` etc â€¦

Nous voulons ici une gestion unique des `Dialog` au sein de notre application. Nous allons pour Ã§a utiliser le `State Management Pattern` et lâ€™`API Context.` L'idÃ©e est de gÃ©rer les Ã©tats (`states`) des dialogue dans un contexte commun.

Il faut voir cela comme des states partagÃ©s dans notre application (et non pas uniquement dans un composant donnÃ©)

Un des cas les plus classique pour reprÃ©senter ce pattern est la gestion du thÃ¨me dans une application

### 1. **CrÃ©er un contexte**

CrÃ©e un fichier pour ton contexte, par exemple `ThemeContext.tsx` :

```tsx
import { createContext, ReactNode, useContext, useState } from 'react';

// CrÃ©er le contexte
export const ThemeContext = createContext<{
  theme: string;
  toggleTheme: () => void;
} | null>(null);

// Fournir le contexte
export const ThemeProvider = ({ children }: { children: ReactNode }) => {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme((prev) => (prev === 'light' ? 'dark' : 'light'));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

// Hook personnalisÃ© pour simplifier l'utilisation du contexte
export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};
```

Note : Depuis React 19 il est possible dâ€™utiliser `use` Ã  la place de `useContext`

- [https://react.dev/reference/react/use](https://react.dev/reference/react/use)

### 2. **Utiliser le contexte dans l'application**

IntÃ¨gre le `ThemeProvider` dans l'arborescence de ton application.

### `App.tsx`

```tsx

import { ThemeProvider } from './ThemeContext';
import ThemeSwitcher from './ThemeSwitcher';

function App() {
  return (
    <ThemeProvider>
      <div>
        <h1>Exemple de Contexte</h1>
        <ThemeSwitcher />
      </div>
    </ThemeProvider>
  );
}

export default App;

```

Un composant qui nomme le contexte pour afficher et modifier le thÃ¨me.

### `ThemeSwitcher.tsx`

```tsx

import { useTheme } from './ThemeContext';

const ThemeSwitcher = () => {
  const { theme, toggleTheme } = useTheme();

  return (
    <div>
      <p>ThÃ¨me actuel : {theme}</p>
      <button onClick={toggleTheme}>
        Basculer en {theme === 'light' ? 'sombre' : 'clair'}
      </button>
    </div>
  );
};

export default ThemeSwitcher;

```

## Exercice

Dans cet exercice tu vas devoir implÃ©menter la gestion des modal (`shadcn`) avec le context API.

- [https://react.dev/reference/react/createContext](https://react.dev/reference/react/createContext)
- [https://react.dev/reference/react/use](https://react.dev/reference/react/use)

**ğŸ¶** Dans un premier temps crÃ©er le `ModalProvider` / `ModalContext` et le hook `useModal` dans `componant/modal.ts`

**ğŸ¶ Ensuite utilise** `ModalProvider` dans le `RootLayout` pour pouvoir utiliser `useModal` partout dans lâ€™application

Fichiers

- `componant/modal.ts`
- `app/layout.ts`

## Bonus

### 1. ğŸš€ Modal Ã  partir dâ€™un bouton (Ajout)

Dans cet exercice tu vas devoir crÃ©er un bouton qui ouvre la modal qui contient le formulaire dâ€™ajout

Pour gagner du temps les formulaires sont dÃ©jÃ  crÃ©Ã©s avec [`shadcn /zod / rhf`](https://ui.shadcn.com/docs/components/form)

- `component/dashboard/trackers/finance/forms/create-edit-finance-form.tsx`
- `component/dashboard/trackers/finance/forms/delete-finance-form.tsx`
- `component/dashboard/trackers/health/forms/create-edit-health-form.tsx`
- `component/dashboard/trackers/health/forms/delete-health-form.tsx`

Et le composant `AddItemButton` est dÃ©jÃ  ajoutÃ© dans les `Tables`; nous allons pouvoir travailler directement dans ce composant

- `component/dashboard/trackers/add-item-button.tsx`

```tsx
const FinanceDataTable = ({finances, uid}: FinanceDataTableProps) => {
  const label = 'Tracker une dÃ©pense / revenu'
  return (
    <Card className="flex w-full flex-col space-y-2 py-4 md:items-start md:px-8">
	     {/* AddItemButton  */}
      <AddItemButton trackerType="finance" uid={uid} label={label} />
      <DataTable columns={financeColumns} dataTable={finances} />
    </Card>
  )
}
```

- **ğŸ¶ Dans cet exercice utilise le `hook useModal` crÃ©Ã© prÃ©cÃ©demment de la maniÃ¨re suivante :**

```tsx
const {onClose, setModal, onOpen} = useModal()
//
return (
  <Button
    onClick={() => {
      setModal({
        title: `Ajout`,
        children: <FormAdd onClose={onClose} uid={uid} />,
      })
      onOpen()
    }}
  >
  </Button>
  )

```

ğŸ’¡ Attention : nous allons faire en sorte que le composant puisse prendre diffÃ©rents type de Formulaires pour le rendre plus gÃ©nÃ©rique, des :

- `CreateEditFinanceForm` ou
- `CreateEditHealthForm`

ğŸ’¡ VÃ©rifie lâ€™appel des servers actions `health-action` / `finance-action`

Fichiers

- `component/dashboard/trackers/add-item-button.tsx`

### 2. ğŸš€ Modal dans une table (Update / Delete Item)

Nous avions rajouter une colonnes action avec `update` / `delete` mais sans effet. Nous allons maintenant ouvrir les modal correspondant a `update` et `delete` avec le `Formulaire` correspondant. Tout ce passe dans `data-table-row-actions`

```tsx
  <DropdownMenu>
      <DropdownMenuTrigger asChild className="p-2">
        <Button variant="ghost" className="h-8 w-8 p-0">
          <span className="sr-only">Ouvrir menu</span>
          <MoreHorizontal className="h-4 w-4" />
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        <DropdownMenuItem>Editer</DropdownMenuItem>
        <DropdownMenuItem>Supprimer</DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
```

ğŸ’¡ Attention : nous allons faire en sorte que le composant puisse prendre diffÃ©rents type de Formulaires pour le rendre plus gÃ©nÃ©rique.

ğŸ’¡ VÃ©rifie lâ€™appel des servers actions `health-action` / `finance-action`

Fichiers

- `component/ui/data-table-row-actions.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://ui.shadcn.com/docs/components/form](https://ui.shadcn.com/docs/components/form)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.SAAS%20Entrepreneur&entry.533578441=07-modal-form-edition).
