# Chart Health Bar

### 💡 Faire un graphique de santé en barre (par semaine)

## 📝 Tes notes

Détaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Le graphique de santé est un graphique sous forme de barres.

- Sur l’axe X : Les jours de la semaine sélectionnée
- Sur l’axe Y :
  - 3 barres par jour (Poids / Calories / Temps de sport )

Pour faire des graphiques en barre, nous avons à notre disposition avec [shadcn](https://ui.shadcn.com/docs/components/chart) un composant `<BarChart>` : Voilà un exemple basique :

```tsx
<ChartContainer
      config={chartConfig}
      className="max-h-96 min-h-[200px] w-full"
    >
      <BarChart
        accessibilityLayer
        data={[
          {month: 'Jan', desktop: 4354, mobile: 120},
          {month: 'Feb', desktop: 5688, mobile: 280},
          {month: 'Mar', desktop: 0, mobile: 120},
          {month: 'Jul', desktop: 2345, mobile: 394},
        ]}
      >
        <XAxis
          dataKey="month"
          tickLine={false}
          tickMargin={10}
          axisLine={false}
          tickFormatter={(value) => value.slice(0, 3)}
        />

        <ChartTooltip
          cursor={false}
          content={<ChartTooltipContent indicator="dashed" />}
        />
        <ChartLegend content={<ChartLegendContent />} />
        <Bar
          dataKey="desktop"
          radius={4}
        />
        <Bar
          dataKey="mobile"
          radius={4}
        />
      </BarChart>
    </ChartContainer>
```

📑 Le lien vers la doc [https://ui.shadcn.com/docs/components/chart](https://ui.shadcn.com/docs/components/chart)

## Exercice

Dans cet exercice, nous allons devoir créer `une requête imbriquée`

- Dans un premier temps, crée la requête permettant de récupérer les données de santé pour :
- Un `user` à une `année` et `semaine` précises.

```tsx
.where(
      sql`${health.userId} = ${uid} AND EXTRACT(WEEK FROM ${health.date} AT TIME ZONE 'UTC') = ${week} AND EXTRACT(YEAR FROM ${health.date} AT TIME ZONE 'UTC') = ${year}`
    )
```

- Groupées par jour de la semaine (monday … sunday)

```tsx
.groupBy(sql`EXTRACT(DAY FROM ${health.date} AT TIME ZONE 'UTC')`)
```

- Avec la somme des éléments par catégorie sur un jour : (ex : toutes les calories du jour X)

```tsx
 calories:
    sql<number>`SUM(CASE WHEN ${health.category} = 'calories' THEN ${health.value} ELSE NULL END)`.as(
      'calories'
    ),
```

- Création d’un alias

```tsx
.as('sq')
```

Nous pourrons ensuite faire une requête sur l’alias créé précédemment.

```tsx
const rows = await db
    .select({
      week: sq.week,
      calories: sq.calories,
      temps: sq.temps,
      poids: sq.poids,
    })
    .from(sq)
    .orderBy(sq.week)
```

- **🐶** Dans cet exercice, implémente **`getHealthsChartbyWeekDao`** dans \*\*\*\*`health-repository.ts`

Fais en sorte d’avoir des données sous cette forme :

```tsx
healths [
  {
    week: '2025-01-13 00:00:00+00',
    calories: '4354',
    temps: '120',
    poids: '90'
  },
  {
    week: '2025-01-14 00:00:00+00',
    calories: '5688',
    temps: '280',
    poids: '99'
  },
]
```

- **🐶** Dans un second temps, appelle cette fonction dans la route :

```tsx
const healths = await getHealthsChartbyWeek
//helper pour formatter le jour
const healthsFormatted = formatedHealthData(healths, 'week')
//HealthBarChart
 <HealthBarChart data={healthsFormatted} />

```

Fichiers

- `data/repositories/health-repository.ts`
- `app/(app)/health/page.tsx`

## Bonus

### 1. 🚀 Créer le graphique en barre

Le graphique en barre s’utilise avec un `<BarChart accessibilityLayer data={data}>` et des `<Bar>`. Exemple :

```tsx
 <Bar
	  dataKey="calories"
	  fill="var(--color-calories)"
	  radius={4}
	  yAxisId={'calories'}
	/>
```

- **🐶** Crée le graphique en barre

Fichiers

- `/components/dashboard/trackers/health/health-bar-chart.tsx`

### 2. 🚀 Valeur par défaut

Fais en sorte d'avoir des valeurs à zéro pour les jours vides.

Fichiers

- `formatedHealthData`

## Aller plus loin

📑 Le lien vers la doc [https://ui.shadcn.com/docs/components/chart](https://ui.shadcn.com/docs/components/chart)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=9.SAAS%20Entrepreneur&entry.533578441=09%20chart-health-bar).
