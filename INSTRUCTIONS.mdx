# Chart Finance (ReChart)

### 💡 Fait des graphiques

## 📝 Tes notes

Detaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Pour faire des graphiques il existe une excellent librairie React : [ReChart](https://recharts.org/en-US/)

De plus [shadcn](https://ui.shadcn.com/docs/components/chart) a introduit un composant chart basé sur reChart, nous l’avons ajouté au projet.

```tsx
pnpm dlx shadcn@latest add chart
```

Nous allons ici utiliser 2 types de graphiques

- Sous forme de ligne `LineChart`
- Sous forme de bar `BarChart`

📑 Le liens vers la doc [https://ui.shadcn.com/docs/components/chart](https://ui.shadcn.com/docs/components/chart)

Pour gagner du temps nous avons mise en place dans `global.css`

```css
--chart-1: 12 76% 61%;
--chart-2: 173 58% 39%;
--chart-3: 197 37% 24%;
--chart-4: 43 74% 66%;
--chart-5: 27 87% 67%;
```

que nous pouvons utiliser pour de la configuration comme par exemple

### LineChart

Exemple de configuration :

```tsx
const chartConfig = {
  visitors: {
    label: "Total Visitors",
  },
  chrome: {
    label: "Chrome",
    color: "hsl(var(--chart-1))",
  },
  safari: {
    label: "Safari",
    color: "hsl(var(--chart-2))",
  },
} satisfies ChartConfig
```

Exemple de graphique:

```tsx
   <ChartContainer
      config={chartConfig}
      className="max-h-96 min-h-[200px] w-full"
    >
      <LineChart
        accessibilityLayer
        data={[
          {
            browser: 'Chrome',
            visitors: 275,
          },
          {browser: 'Firefox', visitors: 564},
          {browser: 'Arc', visitors: 345},
          {browser: 'Safari', visitors: 699},
          {browser: 'Opera', visitors: 34},
        ]}
      >
        <XAxis
          dataKey="browser"
          tickLine={false}
          axisLine={false}
          tickMargin={8}
          tickFormatter={(value) => value}
        />
        <ChartTooltip cursor={false} content={<ChartTooltipContent />} />
        <ChartLegend content={<ChartLegendContent />} />
        <Line
          dataKey="visitors"
          type="monotone"
          stroke="var(--color-revenus)"
          strokeWidth={2}
          dot={false}
        />
      </LineChart>
    </ChartContainer>
```

## Exercice

Dans cet exercice tu vas devoir créer un `LineChart` pour les finances .

Le but est d’avoir toutes les données sur une années grouper par mois et types

- Sur l’axe X : Les mois de l’années ou il y a des données
- Sur l’axe Y : La valeurs en euros
- Line 1 : La courbes des revenus
- Line 2 : La courbes des dépenses
- Line 3 : La courbes des actifs

- **🐶 Dans un premier temps créé le Dao `getFinancesChartByYearDao`**

Récupère les totaux mensuels des dépenses, revenus et actifs d'un utilisateur pour une année donnée, triés chronologiquement.

En terme SQL :

- filtre par année et user :
  ```tsx
   .where(
        sql`${finance.userId} = ${uid} AND EXTRACT(YEAR FROM ${finance.date}) = ${year}`
      )
  ```
- groupe par mois et années
  ```tsx
   .groupBy(
        sql`EXTRACT(YEAR FROM ${finance.date})`,
        sql`EXTRACT(MONTH FROM ${finance.date})`
      )
  ```
- trie
  ```tsx
  .orderBy(
      desc(sql`EXTRACT(YEAR FROM ${finance.date})`),
      sql`EXTRACT(MONTH FROM ${finance.date})`
    )
  ```
- Sommes de chaque `catégorie`

```tsx
sql<number>`SUM(CASE WHEN ${finance.category} = 'dépenses' THEN ${finance.amount} END)`.as(
          'dépenses'
        ),
```

- **🐶 Implémente cette fonction dans** `finance-repository.ts` dans**le but d’avoir cette forme la**

```tsx
[
  { month: 'Jan', 'dépenses': 1234, revenus: 3434, actifs: 3000 },
  { month: 'Feb', 'dépenses': 0, revenus: 345, actifs: 0 },
  { month: 'Apr', 'dépenses': 699, revenus: 0, actifs: 0 },
  { month: 'Sep', 'dépenses': 0, revenus: 1136, actifs: 0 }
]
```

note : le service appelle déjà le repository, il n’y a rien a faire , tu peux appeler le service `getFinancesChartByYear` depuis la route

- **🐶**Adapte la route `app/(app)/finance/page.ts` pour appeler `getFinancesChartByYear` et passer les données à notre `LineChart`

```tsx
const financesForChart = await getFinancesChartByYear(financeYear, userId)
<FinanceLineChart data={financeFormatted} />
```

Note : utilise `formatedFinanceData` une fonction qui formatte les valeurs `null` et `undefined` pour le graphique

Fichiers

- `data/repositories/finance-repository.ts`
- `app/(app)/finance/page.ts`

## Bonus

### 1. 🚀 Chart Finance

**🐶** Dans cette exercice tu vas devoir créer le graphique en ligne `FinanceLineChart`

- Step 1 : `chartConfig` avec les couleurs des lignes
- Step 2 : Créer un `ChartContainer` `LineChart`
- Step 3 : Créer un `XAxis` pour configurer l’axe des abscisses
- Step 4 : Créer les 3 lignes avec le composant `Line`

Fichiers

- `component/dashboard/finance/finance-line-chart.tsx`

### 2. 🚀 Mettre les mois vide à zero

Il se peut que l’utilisateur n’entre pas de données sur certains mois. Dans ce cas il est possible d’adapter `formatedFinanceData` pour mettre les mois à zéro

Fichiers

- `chart-utils.tsx`

## Aller plus loin

📑 Le lien vers la doc de [ReChart](https://recharts.org/en-US/)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.SAAS%20Entrepreneur&entry.533578441=08-chart-finance-line).
